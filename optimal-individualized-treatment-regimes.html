<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Optimal Individualized Treatment Regimes | The tlverse Software Ecosystem for Causal Inference</title>
  <meta name="description" content="An open-source and fully-reproducible electronic set of teaching materials accompanying a full-day short-course on applying the Targeted Learning methodology in practice using the tlverse software ecosystem." />
  <meta name="generator" content="bookdown  and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Optimal Individualized Treatment Regimes | The tlverse Software Ecosystem for Causal Inference" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://tlverse.org/acic2019-workshop/" />
  
  <meta property="og:description" content="An open-source and fully-reproducible electronic set of teaching materials accompanying a full-day short-course on applying the Targeted Learning methodology in practice using the tlverse software ecosystem." />
  <meta name="github-repo" content="tlverse/acic2019-workshop" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Optimal Individualized Treatment Regimes | The tlverse Software Ecosystem for Causal Inference" />
  
  <meta name="twitter:description" content="An open-source and fully-reproducible electronic set of teaching materials accompanying a full-day short-course on applying the Targeted Learning methodology in practice using the tlverse software ecosystem." />
  

<meta name="author" content="Mark van der Laan, Alan Hubbard, Jeremy Coyle, Nima Hejazi, Ivana Malenica, Rachael Phillips" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="img/logos/favicons/favicon.png" type="image/x-icon" />
<link rel="prev" href="tmle3-the-targeted-learning-framework.html">
<link rel="next" href="stochastic-treatment-regimes.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<link href="libs/vis-4.20.1/vis.css" rel="stylesheet" />
<script src="libs/vis-4.20.1/vis.min.js"></script>
<script src="libs/visNetwork-binding-2.0.6/visNetwork.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">The Hitchhiker's Guide to the tlverse</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-this-workshop"><i class="fa fa-check"></i>About this workshop</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-instructors"><i class="fa fa-check"></i>About the instructors</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#mark-van-der-laan"><i class="fa fa-check"></i>Mark van der Laan</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#alan-hubbard"><i class="fa fa-check"></i>Alan Hubbard</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#jeremy-coyle"><i class="fa fa-check"></i>Jeremy Coyle</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#nima-hejazi"><i class="fa fa-check"></i>Nima Hejazi</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#ivana-malenica"><i class="fa fa-check"></i>Ivana Malenica</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#rachael-phillips"><i class="fa fa-check"></i>Rachael Phillips</a></li>
</ul></li>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#important-links"><i class="fa fa-check"></i><b>0.1</b> Important links</a></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#setup-instructions"><i class="fa fa-check"></i><b>0.2</b> Setup instructions</a><ul>
<li class="chapter" data-level="0.2.1" data-path="index.html"><a href="index.html#r-and-rstudio"><i class="fa fa-check"></i><b>0.2.1</b> R and RStudio</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="motivation.html"><a href="motivation.html"><i class="fa fa-check"></i>Motivation</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Welcome to the <code>tlverse</code></a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#learning-objectives"><i class="fa fa-check"></i><b>1.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#what-is-the-tlverse"><i class="fa fa-check"></i><b>1.2</b> What is the <code>tlverse</code>?</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#tlverse-components"><i class="fa fa-check"></i><b>1.3</b> <code>tlverse</code> components</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#installation"><i class="fa fa-check"></i><b>1.4</b> Installation</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#the-targeted-learning-roadmap"><i class="fa fa-check"></i><b>1.5</b> The Targeted Learning Roadmap</a><ul>
<li class="chapter" data-level="1.5.1" data-path="intro.html"><a href="intro.html#the-statistical-model"><i class="fa fa-check"></i><b>1.5.1</b> The Statistical Model</a></li>
<li class="chapter" data-level="1.5.2" data-path="intro.html"><a href="intro.html#the-causal-model"><i class="fa fa-check"></i><b>1.5.2</b> The Causal Model</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="intro.html"><a href="intro.html#the-parameter-of-interest"><i class="fa fa-check"></i><b>1.6</b> The Parameter of Interest</a><ul>
<li class="chapter" data-level="1.6.1" data-path="intro.html"><a href="intro.html#identifiability"><i class="fa fa-check"></i><b>1.6.1</b> Identifiability</a></li>
<li class="chapter" data-level="1.6.2" data-path="intro.html"><a href="intro.html#estimator"><i class="fa fa-check"></i><b>1.6.2</b> Estimator</a></li>
<li class="chapter" data-level="1.6.3" data-path="intro.html"><a href="intro.html#inference"><i class="fa fa-check"></i><b>1.6.3</b> Inference</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="intro.html"><a href="intro.html#the-wash-benefits-example-dataset"><i class="fa fa-check"></i><b>1.7</b> The WASH Benefits Example Dataset</a><ul>
<li class="chapter" data-level="1.7.1" data-path="intro.html"><a href="intro.html#the-variables"><i class="fa fa-check"></i><b>1.7.1</b> The variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="modern-super-machine-learning-with-sl3.html"><a href="modern-super-machine-learning-with-sl3.html"><i class="fa fa-check"></i><b>2</b> Modern Super (Machine) Learning with <code>sl3</code></a><ul>
<li class="chapter" data-level="2.1" data-path="modern-super-machine-learning-with-sl3.html"><a href="modern-super-machine-learning-with-sl3.html#learning-objectives-1"><i class="fa fa-check"></i><b>2.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="2.2" data-path="modern-super-machine-learning-with-sl3.html"><a href="modern-super-machine-learning-with-sl3.html#introduction"><i class="fa fa-check"></i><b>2.2</b> Introduction</a></li>
<li class="chapter" data-level="2.3" data-path="modern-super-machine-learning-with-sl3.html"><a href="modern-super-machine-learning-with-sl3.html#basic-implementation"><i class="fa fa-check"></i><b>2.3</b> Basic Implementation</a><ul>
<li class="chapter" data-level="2.3.1" data-path="modern-super-machine-learning-with-sl3.html"><a href="modern-super-machine-learning-with-sl3.html#wash-benefits-study-example"><i class="fa fa-check"></i><b>2.3.1</b> WASH Benefits Study Example</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="modern-super-machine-learning-with-sl3.html"><a href="modern-super-machine-learning-with-sl3.html#extensions"><i class="fa fa-check"></i><b>2.4</b> Extensions</a><ul>
<li class="chapter" data-level="2.4.1" data-path="modern-super-machine-learning-with-sl3.html"><a href="modern-super-machine-learning-with-sl3.html#customize-learner-hyperparameters"><i class="fa fa-check"></i><b>2.4.1</b> Customize Learner Hyperparameters</a></li>
<li class="chapter" data-level="2.4.2" data-path="modern-super-machine-learning-with-sl3.html"><a href="modern-super-machine-learning-with-sl3.html#screening-covariates"><i class="fa fa-check"></i><b>2.4.2</b> Screening covariates</a></li>
<li class="chapter" data-level="2.4.3" data-path="modern-super-machine-learning-with-sl3.html"><a href="modern-super-machine-learning-with-sl3.html#cross-validated-super-learner"><i class="fa fa-check"></i><b>2.4.3</b> Cross-validated super learner</a></li>
<li class="chapter" data-level="2.4.4" data-path="modern-super-machine-learning-with-sl3.html"><a href="modern-super-machine-learning-with-sl3.html#variable-importance"><i class="fa fa-check"></i><b>2.4.4</b> Variable importance</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="modern-super-machine-learning-with-sl3.html"><a href="modern-super-machine-learning-with-sl3.html#exercise"><i class="fa fa-check"></i><b>2.5</b> Exercise</a><ul>
<li class="chapter" data-level="2.5.1" data-path="modern-super-machine-learning-with-sl3.html"><a href="modern-super-machine-learning-with-sl3.html#predicting-myocardial-infarction-with-sl3"><i class="fa fa-check"></i><b>2.5.1</b> Predicting myocardial infarction with <code>sl3</code></a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="modern-super-machine-learning-with-sl3.html"><a href="modern-super-machine-learning-with-sl3.html#concluding-remarks"><i class="fa fa-check"></i><b>2.6</b> Concluding Remarks</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="tmle3-the-targeted-learning-framework.html"><a href="tmle3-the-targeted-learning-framework.html"><i class="fa fa-check"></i><b>3</b> <code>tmle3</code> – The Targeted Learning Framework</a><ul>
<li class="chapter" data-level="3.1" data-path="tmle3-the-targeted-learning-framework.html"><a href="tmle3-the-targeted-learning-framework.html#learning-objectives-2"><i class="fa fa-check"></i><b>3.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="3.2" data-path="tmle3-the-targeted-learning-framework.html"><a href="tmle3-the-targeted-learning-framework.html#example-tmle3-for-ate"><i class="fa fa-check"></i><b>3.2</b> Example: <code>tmle3</code> for ATE</a><ul>
<li class="chapter" data-level="3.2.1" data-path="tmle3-the-targeted-learning-framework.html"><a href="tmle3-the-targeted-learning-framework.html#load-the-data"><i class="fa fa-check"></i><b>3.2.1</b> Load the Data</a></li>
<li class="chapter" data-level="3.2.2" data-path="tmle3-the-targeted-learning-framework.html"><a href="tmle3-the-targeted-learning-framework.html#define-the-variable-roles"><i class="fa fa-check"></i><b>3.2.2</b> Define the variable roles</a></li>
<li class="chapter" data-level="3.2.3" data-path="tmle3-the-targeted-learning-framework.html"><a href="tmle3-the-targeted-learning-framework.html#handling-missingness"><i class="fa fa-check"></i><b>3.2.3</b> Handling Missingness</a></li>
<li class="chapter" data-level="3.2.4" data-path="tmle3-the-targeted-learning-framework.html"><a href="tmle3-the-targeted-learning-framework.html#create-a-spec-object"><i class="fa fa-check"></i><b>3.2.4</b> Create a “Spec” Object</a></li>
<li class="chapter" data-level="3.2.5" data-path="tmle3-the-targeted-learning-framework.html"><a href="tmle3-the-targeted-learning-framework.html#define-the-learners"><i class="fa fa-check"></i><b>3.2.5</b> Define the learners</a></li>
<li class="chapter" data-level="3.2.6" data-path="tmle3-the-targeted-learning-framework.html"><a href="tmle3-the-targeted-learning-framework.html#fit-the-tmle"><i class="fa fa-check"></i><b>3.2.6</b> Fit the TMLE</a></li>
<li class="chapter" data-level="3.2.7" data-path="tmle3-the-targeted-learning-framework.html"><a href="tmle3-the-targeted-learning-framework.html#evaluate-the-estimates"><i class="fa fa-check"></i><b>3.2.7</b> Evaluate the Estimates</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="tmle3-the-targeted-learning-framework.html"><a href="tmle3-the-targeted-learning-framework.html#tmle3-components"><i class="fa fa-check"></i><b>3.3</b> <code>tmle3</code> Components</a><ul>
<li class="chapter" data-level="3.3.1" data-path="tmle3-the-targeted-learning-framework.html"><a href="tmle3-the-targeted-learning-framework.html#tmle3_task"><i class="fa fa-check"></i><b>3.3.1</b> <code>tmle3_task</code></a></li>
<li class="chapter" data-level="3.3.2" data-path="tmle3-the-targeted-learning-framework.html"><a href="tmle3-the-targeted-learning-framework.html#initial-likelihood"><i class="fa fa-check"></i><b>3.3.2</b> Initial Likelihood</a></li>
<li class="chapter" data-level="3.3.3" data-path="tmle3-the-targeted-learning-framework.html"><a href="tmle3-the-targeted-learning-framework.html#targeted-likelihood-updater"><i class="fa fa-check"></i><b>3.3.3</b> Targeted Likelihood (updater)</a></li>
<li class="chapter" data-level="3.3.4" data-path="tmle3-the-targeted-learning-framework.html"><a href="tmle3-the-targeted-learning-framework.html#parameter-mapping"><i class="fa fa-check"></i><b>3.3.4</b> Parameter Mapping</a></li>
<li class="chapter" data-level="3.3.5" data-path="tmle3-the-targeted-learning-framework.html"><a href="tmle3-the-targeted-learning-framework.html#putting-it-all-together"><i class="fa fa-check"></i><b>3.3.5</b> Putting it all together</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="tmle3-the-targeted-learning-framework.html"><a href="tmle3-the-targeted-learning-framework.html#fitting-tmle3-with-multiple-parameters"><i class="fa fa-check"></i><b>3.4</b> Fitting <code>tmle3</code> with multiple parameters</a><ul>
<li class="chapter" data-level="3.4.1" data-path="tmle3-the-targeted-learning-framework.html"><a href="tmle3-the-targeted-learning-framework.html#delta-method"><i class="fa fa-check"></i><b>3.4.1</b> Delta Method</a></li>
<li class="chapter" data-level="3.4.2" data-path="tmle3-the-targeted-learning-framework.html"><a href="tmle3-the-targeted-learning-framework.html#fit"><i class="fa fa-check"></i><b>3.4.2</b> Fit</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="tmle3-the-targeted-learning-framework.html"><a href="tmle3-the-targeted-learning-framework.html#exercise-1"><i class="fa fa-check"></i><b>3.5</b> Exercise</a></li>
<li class="chapter" data-level="3.6" data-path="tmle3-the-targeted-learning-framework.html"><a href="tmle3-the-targeted-learning-framework.html#summary"><i class="fa fa-check"></i><b>3.6</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="optimal-individualized-treatment-regimes.html"><a href="optimal-individualized-treatment-regimes.html"><i class="fa fa-check"></i><b>4</b> Optimal Individualized Treatment Regimes</a><ul>
<li class="chapter" data-level="4.1" data-path="optimal-individualized-treatment-regimes.html"><a href="optimal-individualized-treatment-regimes.html#learning-objectives-3"><i class="fa fa-check"></i><b>4.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="4.2" data-path="optimal-individualized-treatment-regimes.html"><a href="optimal-individualized-treatment-regimes.html#introduction-to-optimal-individualized-interventions"><i class="fa fa-check"></i><b>4.2</b> Introduction to Optimal Individualized Interventions</a></li>
<li class="chapter" data-level="4.3" data-path="optimal-individualized-treatment-regimes.html"><a href="optimal-individualized-treatment-regimes.html#data-structure-and-notation"><i class="fa fa-check"></i><b>4.3</b> Data Structure and Notation</a></li>
<li class="chapter" data-level="4.4" data-path="optimal-individualized-treatment-regimes.html"><a href="optimal-individualized-treatment-regimes.html#defining-the-causal-effect-of-an-optimal-individualized-intervention"><i class="fa fa-check"></i><b>4.4</b> Defining the Causal Effect of an Optimal Individualized Intervention</a></li>
<li class="chapter" data-level="4.5" data-path="optimal-individualized-treatment-regimes.html"><a href="optimal-individualized-treatment-regimes.html#binary-treatment"><i class="fa fa-check"></i><b>4.5</b> Binary treatment</a></li>
<li class="chapter" data-level="4.6" data-path="optimal-individualized-treatment-regimes.html"><a href="optimal-individualized-treatment-regimes.html#extensions-to-causal-effect-of-an-optimal-individualized-intervention"><i class="fa fa-check"></i><b>4.6</b> Extensions to Causal Effect of an Optimal Individualized Intervention</a><ul>
<li class="chapter" data-level="4.6.1" data-path="optimal-individualized-treatment-regimes.html"><a href="optimal-individualized-treatment-regimes.html#simpler-rules"><i class="fa fa-check"></i><b>4.6.1</b> Simpler Rules</a></li>
<li class="chapter" data-level="4.6.2" data-path="optimal-individualized-treatment-regimes.html"><a href="optimal-individualized-treatment-regimes.html#realistic-optimal-individual-regimes"><i class="fa fa-check"></i><b>4.6.2</b> Realistic Optimal Individual Regimes</a></li>
<li class="chapter" data-level="4.6.3" data-path="optimal-individualized-treatment-regimes.html"><a href="optimal-individualized-treatment-regimes.html#variable-importance-analysis"><i class="fa fa-check"></i><b>4.6.3</b> Variable Importance Analysis</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="optimal-individualized-treatment-regimes.html"><a href="optimal-individualized-treatment-regimes.html#categorical-treatment"><i class="fa fa-check"></i><b>4.7</b> Categorical treatment</a></li>
<li class="chapter" data-level="4.8" data-path="optimal-individualized-treatment-regimes.html"><a href="optimal-individualized-treatment-regimes.html#exercise-optimal-individualized-intervention-with-categorical-treatment"><i class="fa fa-check"></i><b>4.8</b> Exercise: Optimal Individualized Intervention with Categorical Treatment</a></li>
<li class="chapter" data-level="4.9" data-path="optimal-individualized-treatment-regimes.html"><a href="optimal-individualized-treatment-regimes.html#exercise-wash-benefits-data"><i class="fa fa-check"></i><b>4.9</b> Exercise: WASH Benefits Data</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="stochastic-treatment-regimes.html"><a href="stochastic-treatment-regimes.html"><i class="fa fa-check"></i><b>5</b> Stochastic Treatment Regimes</a><ul>
<li class="chapter" data-level="5.1" data-path="stochastic-treatment-regimes.html"><a href="stochastic-treatment-regimes.html#learning-objectives-4"><i class="fa fa-check"></i><b>5.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="5.2" data-path="stochastic-treatment-regimes.html"><a href="stochastic-treatment-regimes.html#introduction-1"><i class="fa fa-check"></i><b>5.2</b> Introduction</a></li>
<li class="chapter" data-level="5.3" data-path="stochastic-treatment-regimes.html"><a href="stochastic-treatment-regimes.html#stochastic-interventions"><i class="fa fa-check"></i><b>5.3</b> Stochastic Interventions</a><ul>
<li class="chapter" data-level="5.3.1" data-path="stochastic-treatment-regimes.html"><a href="stochastic-treatment-regimes.html#identifying-the-causal-effect-of-a-stochastic-intervention"><i class="fa fa-check"></i><b>5.3.1</b> Identifying the Causal Effect of a Stochastic Intervention</a></li>
<li class="chapter" data-level="5.3.2" data-path="stochastic-treatment-regimes.html"><a href="stochastic-treatment-regimes.html#interpreting-the-causal-effect-of-a-stochastic-intervention"><i class="fa fa-check"></i><b>5.3.2</b> Interpreting the Causal Effect of a Stochastic Intervention</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="stochastic-treatment-regimes.html"><a href="stochastic-treatment-regimes.html#estimating-the-causal-effect-of-a-stochastic-intervention-with-tmle3shift"><i class="fa fa-check"></i><b>5.4</b> Estimating the Causal Effect of a Stochastic Intervention with <code>tmle3shift</code></a><ul>
<li class="chapter" data-level="5.4.1" data-path="stochastic-treatment-regimes.html"><a href="stochastic-treatment-regimes.html#simulate-data-1"><i class="fa fa-check"></i><b>5.4.1</b> Simulate Data</a></li>
<li class="chapter" data-level="5.4.2" data-path="stochastic-treatment-regimes.html"><a href="stochastic-treatment-regimes.html#targeted-estimation-of-stochastic-interventions-effects"><i class="fa fa-check"></i><b>5.4.2</b> Targeted Estimation of Stochastic Interventions Effects</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="stochastic-treatment-regimes.html"><a href="stochastic-treatment-regimes.html#stochastic-interventions-over-a-grid-of-counterfactual-shifts"><i class="fa fa-check"></i><b>5.5</b> Stochastic Interventions over a Grid of Counterfactual Shifts</a><ul>
<li class="chapter" data-level="5.5.1" data-path="stochastic-treatment-regimes.html"><a href="stochastic-treatment-regimes.html#initializing-vimshift-through-its-tmle3_spec"><i class="fa fa-check"></i><b>5.5.1</b> Initializing <code>vimshift</code> through its <code>tmle3_Spec</code></a></li>
<li class="chapter" data-level="5.5.2" data-path="stochastic-treatment-regimes.html"><a href="stochastic-treatment-regimes.html#targeted-estimation-of-stochastic-intervention-effects"><i class="fa fa-check"></i><b>5.5.2</b> Targeted Estimation of Stochastic Intervention Effects</a></li>
<li class="chapter" data-level="5.5.3" data-path="stochastic-treatment-regimes.html"><a href="stochastic-treatment-regimes.html#inference-with-marginal-structural-models"><i class="fa fa-check"></i><b>5.5.3</b> Inference with Marginal Structural Models</a></li>
<li class="chapter" data-level="5.5.4" data-path="stochastic-treatment-regimes.html"><a href="stochastic-treatment-regimes.html#directly-targeting-the-msm-parameter-beta"><i class="fa fa-check"></i><b>5.5.4</b> Directly Targeting the MSM Parameter <span class="math inline">\(\beta\)</span></a></li>
<li class="chapter" data-level="5.5.5" data-path="stochastic-treatment-regimes.html"><a href="stochastic-treatment-regimes.html#example-with-the-wash-benefits-data"><i class="fa fa-check"></i><b>5.5.5</b> Example with the WASH Benefits Data</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="stochastic-treatment-regimes.html"><a href="stochastic-treatment-regimes.html#exercises"><i class="fa fa-check"></i><b>5.6</b> Exercises</a><ul>
<li class="chapter" data-level="5.6.1" data-path="stochastic-treatment-regimes.html"><a href="stochastic-treatment-regimes.html#review-of-key-concepts"><i class="fa fa-check"></i><b>5.6.1</b> Review of Key Concepts</a></li>
<li class="chapter" data-level="5.6.2" data-path="stochastic-treatment-regimes.html"><a href="stochastic-treatment-regimes.html#the-ideas-in-action"><i class="fa fa-check"></i><b>5.6.2</b> The Ideas in Action</a></li>
<li class="chapter" data-level="5.6.3" data-path="stochastic-treatment-regimes.html"><a href="stochastic-treatment-regimes.html#advanced-topics"><i class="fa fa-check"></i><b>5.6.3</b> Advanced Topics</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The <code>tlverse</code> Software Ecosystem for Causal Inference</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="optimal-individualized-treatment-regimes" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Optimal Individualized Treatment Regimes</h1>
<p><em>Ivana Malenica</em>, based on the <a href="https://github.com/tlverse/tmle3mopttx"><code>tmle3mopttx</code>
package</a> by <em>Ivana Malenica, Jeremy
Coyle, and Mark van der Laan</em></p>
<p>Updated: 2019-05-06</p>
<div id="learning-objectives-3" class="section level2">
<h2><span class="header-section-number">4.1</span> Learning Objectives</h2>
<p>By the end of this lesson you will be able to:</p>
<ol style="list-style-type: decimal">
<li>Differentiate between dynamic and optimal dynamic treatment regimes from
static interventions.</li>
<li>Understand the benefits, and challenges, associated with using
optimal individualized treatment regimes in practice.</li>
<li>Contrast the impact of implementing an optimal individualized treatment
in the population with static and dynamic regimes.</li>
<li>Estimate causal effects under optimal individualized treatment regimes with
the <code>tmle3mopttx</code> <code>R</code> package.</li>
<li>Contrast the population impact of implementing optimal individualized
treatment based on sub-optimal rules.</li>
<li>Construct realistic optimal individualized treatments that respect real data
and subject-matter knowledge limitations on interventions.</li>
<li>Understand and implement variable importance analysis defined in terms of
optimal individualized treatment interventions.</li>
</ol>
</div>
<div id="introduction-to-optimal-individualized-interventions" class="section level2">
<h2><span class="header-section-number">4.2</span> Introduction to Optimal Individualized Interventions</h2>
<p>Identifying which intervention will be effective for which patient based on
lifestyle, genetic and environmental factors is a common goal in precision
medicine. One opts to administer the intervention to individuals who will profit
from it, instead of assigning treatment on a population level. This aim
motivates a different type of intervention, as opposed to the static exposures
we might be used to. In this chapter, we learn about dynamic (individualized)
interventions that tailor the treatment decision based on the collected
covariates. In the statistics community, such a treatment strategy is termed
<em>individualized treatment regime</em> (ITR), and the (counterfactual) population
mean outcome under an ITR is the <em>value of the ITR</em>. Even more, suppose one
wishes to maximize the population mean of an outcome, where for each individual
we have access to some set of measured covariates. An ITR with the maximal value
is referred to as an <em>optimal ITR</em> or the <em>optimal individualized treatment</em>.
Consequently, the value of an optimal ITR is termed the <em>optimal value</em>, or the
<em>mean under the optimal individualized treatment</em>.</p>
<p>In this chapter, we examine a simple example of optimal individualized treatment
regimes and estimate the mean outcome under the optimal individualized treatment
where the candidate rules are restricted to depend only on user-supplied subset
of the baseline covariates. In order to accomplish this, we present the
<a href="https://github.com/tlverse/tmle3mopttx"><code>tmle3mopttx</code> R package</a>, which
features an implementation of a recently developed algorithm for computing
targeted minimum loss-based estimates of a causal effect based on optimal
individualized regime for categorical treatment. In particular, we will use
<code>tmle3mopttx</code> to estimate optimal individualized treatments and the
corresponding population value, construct realistic optimal ITRs, and perform
variable importance in terms of the mean under the optimal individualized
treatment.</p>
</div>
<div id="data-structure-and-notation" class="section level2">
<h2><span class="header-section-number">4.3</span> Data Structure and Notation</h2>
<ul>
<li><p>Suppose we observe <span class="math inline">\(n\)</span> independent and identically distributed observations of
the form <span class="math inline">\(O=(W,A,Y) \sim P_0\)</span>. <span class="math inline">\(P_0 \in \mathcal{M}\)</span>, where <span class="math inline">\(\mathcal{M}\)</span> is
the fully nonparametric model.</p></li>
<li><p>Denote <span class="math inline">\(A \in \mathcal{A}\)</span> as categorical treatment, where <span class="math inline">\(\mathcal{A} \equiv \{a_1, \cdots, a_{n_A} \}\)</span> and <span class="math inline">\(n_A = |\mathcal{A}|\)</span>, with <span class="math inline">\(n_A\)</span>
denoting the number of categories.</p></li>
<li><p>Denote <span class="math inline">\(Y\)</span> as the final outcome, and <span class="math inline">\(W\)</span> a vector-valued collection of
baseline covariates.</p></li>
<li><p>The likelihood of the data admits a factorization, implied by the time
ordering of <span class="math inline">\(O\)</span>.
<span class="math display">\[\begin{equation*}\label{eqn:likelihood_factorization}
  p_0(O) = p_{Y,0}(Y \mid A,W) p_{A,0}(A \mid W) p_{W,0}(W) =
    q_{Y,0}(Y \mid A,W) q_{A,0}(A \mid W) q_{W,0}(W),
\end{equation*}\]</span></p></li>
<li><p>Consequently, we define <span class="math inline">\(P_{Y,0}(Y \mid A,W) = Q_{Y,0}(Y \mid A,W)\)</span>,
<span class="math inline">\(P_{A,0}(A \mid W)=g_0(A \mid W)\)</span> and <span class="math inline">\(P_{W,0}(W)=Q_{W,0}(W)\)</span> as the
corresponding conditional distributions of <span class="math inline">\(Y\)</span>, <span class="math inline">\(A\)</span> and <span class="math inline">\(W\)</span>.</p></li>
<li><p>We also define <span class="math inline">\(\bar{Q}_{Y,0}(A,W) \equiv E_0[Y \mid A,W]\)</span>.</p></li>
<li><p>Finally, denote <span class="math inline">\(V\)</span> as <span class="math inline">\(V \in W\)</span>, defining a subset of the baseline covariates
the optimal individualized rule depends on.</p></li>
</ul>
</div>
<div id="defining-the-causal-effect-of-an-optimal-individualized-intervention" class="section level2">
<h2><span class="header-section-number">4.4</span> Defining the Causal Effect of an Optimal Individualized Intervention</h2>
<ul>
<li><p>Consider dynamic treatment rules <span class="math inline">\(V \rightarrow d(V) \in \{a_1, \cdots, a_{n_A} \} \times \{1\}\)</span>, for assigning treatment <span class="math inline">\(A\)</span> based on <span class="math inline">\(V \in W\)</span>.</p></li>
<li><p>Dynamic treatment regime may be viewed as an intervention in which <span class="math inline">\(A\)</span> is set
equal to a value based on a hypothetical regime <span class="math inline">\(d(V)\)</span>, and <span class="math inline">\(Y_{d(V)}\)</span> is the
corresponding counterfactual outcome under <span class="math inline">\(d(V)\)</span>.</p></li>
<li><p>The goal of any causal analysis motivated by an optimal individualized
intervention, is to estimate a parameter defined as the counterfactual mean of
the outcome with respect to the modified intervention distribution.</p></li>
<li><p>Recall causal assumptions:</p></li>
</ul>
<ol style="list-style-type: decimal">
<li><em>Consistency</em>: <span class="math inline">\(Y^{d(v_i)}_i = Y_i\)</span> in the event <span class="math inline">\(A_i = d(v_i)\)</span>,
for <span class="math inline">\(i = 1, \ldots, n\)</span>.</li>
<li><em>Stable unit value treatment assumption (SUTVA)</em>: <span class="math inline">\(Y^{d(v_i)}_i\)</span> does
not depend on <span class="math inline">\(d(v_j)\)</span> for <span class="math inline">\(i = 1, \ldots, n\)</span> and <span class="math inline">\(j \neq i\)</span>, or lack
of interference.</li>
<li><em>Strong ignorability</em>: <span class="math inline">\(A \indep Y^{d(v)} \mid W\)</span>, for all <span class="math inline">\(a \in \mathcal{A}\)</span>.</li>
<li><em>Positivity (or overlap)</em>: <span class="math inline">\(P_0(\min_{a \in \mathcal{A}} g_0(a|W) &gt; 0)=1\)</span></li>
</ol>
<ul>
<li><p>Here, we also assume non-exceptional law is in effect.</p></li>
<li><p>We are primarily interested in the value of an individualized rule,
<span class="math display">\[E_0[Y_{d(V)}] = E_{0,W}[\bar{Q}_{Y,0}(A=d(V),W)].\]</span></p></li>
<li><p>The optimal rule is the rule with the maximal value:
<span class="math display">\[d_{opt}(V) \equiv \text{argmax}_{d(V) \in \mathcal{D}} E_0[Y_{d(V)}]\]</span>
where <span class="math inline">\(\mathcal{D}\)</span> represents the set of possible rules, <span class="math inline">\(d\)</span>, implied by <span class="math inline">\(V\)</span>.</p></li>
<li><p>The target causal estimand of our analysis is
<span class="math display">\[\psi_0 := E_0[Y_{d_{opt}(V)}] =  E_{0,W}[\bar{Q}_{Y,0}(A=d_{opt}(V),W)].\]</span></p></li>
<li><p>General, high-level idea:</p></li>
</ul>
<ol style="list-style-type: decimal">
<li><p>Learn the optimal ITR using Super Learner.</p></li>
<li><p>Estimate its value with the cross-validated Targeted Minimum Loss-based
Estimator (CV-TMLE).</p></li>
</ol>
</div>
<div id="binary-treatment" class="section level2">
<h2><span class="header-section-number">4.5</span> Binary treatment</h2>
<ul>
<li><p>How do we estimate the optimal individualized treatment regime? In the case of
a binary treatment, a key quantity for optimal ITR is the blip function.</p></li>
<li><p>Optimal ITR ideally assigns treatment to individuals falling in strata in
which the stratum-specific average treatment effect, the <em>blip</em> function, is
positive and does not assign treatment to individuals for which this quantity
is negative.</p></li>
<li><p>We define the blip function as:
<span class="math display">\[\bar{Q}_0(V) \equiv E_0[Y_1-Y_0 \mid V] \equiv E_0[\bar{Q}_{Y,0}(1,W) -
  \bar{Q}_{Y,0}(0,W) \mid V],\]</span> or the average treatment effect within a
stratum of <span class="math inline">\(V\)</span>.</p></li>
<li><p>Optimal individualized rule can now be derived as
<span class="math inline">\(d_{opt}(V) = I(\bar{Q}_{0}(V) &gt; 0)\)</span>.</p></li>
<li><p>Relying on the Targeted Maximum Likelihood (TML) estimator and the Super
Learner estimate of the blip function, we follow the below steps in order to
obtain value of the ITR:</p></li>
</ul>
<ol style="list-style-type: decimal">
<li>Estimate <span class="math inline">\(\bar{Q}_{Y,0}(A,W)\)</span> and <span class="math inline">\(g_0(A|W)\)</span> using <code>sl3</code>. We denote such
estimates as <span class="math inline">\(\bar{Q}_{Y,n}(A,W)\)</span> and <span class="math inline">\(g_n(A|W)\)</span>.</li>
<li>Apply the doubly robust Augmented-Inverse Probability Weighted (A-IPW)
transform to our outcome, where we define:
<span class="math display">\[D_{\bar{Q}_Y,g,a}(O) \equiv \frac{I(A=a)}{g(A|W)} (Y-\bar{Q}_Y(A,W)) +
  \bar{Q}_Y(A=a,W)\]</span></li>
</ol>
<p>Note that under the randomization and positivity assumptions we have that
<span class="math inline">\(E[D_{\bar{Q}_Y,g,a}(O) | V] = E[Y_a |V]\)</span>. We emphasize the double robust nature
of the A-IPW transform- consistency of <span class="math inline">\(E[Y_a |V]\)</span> will depend on correct
estimation of either <span class="math inline">\(\bar{Q}_{Y,0}(A,W)\)</span> or <span class="math inline">\(g_0(A|W)\)</span>. As such, in a
randomized trial, we are guaranteed a consistent estimate of <span class="math inline">\(E[Y_a \mid V]\)</span>
even if we get <span class="math inline">\(\bar{Q}_{Y,0}(A,W)\)</span> wrong!</p>
<p>Using this transform, we can define the following contrast:
<span class="math inline">\(D_{\bar{Q}_Y,g}(O) = D_{\bar{Q}_Y,g,a=1}(O) - D_{\bar{Q}_Y,g,a=0}(O)\)</span></p>
<p>We estimate the blip function, <span class="math inline">\(\bar{Q}_{0,a}(V)\)</span>, by regressing
<span class="math inline">\(D_{\bar{Q}_Y,g}(O)\)</span> on <span class="math inline">\(V\)</span> using the specified <code>sl3</code> library of learners and an
appropriate loss function.</p>
<ol start="3" style="list-style-type: decimal">
<li>Our estimated rule is <span class="math inline">\(d(V) = \text{argmax}_{a \in \mathcal{A}} \bar{Q}_{0,a}(V)\)</span>.</li>
<li>We obtain inference for the mean outcome under the estimated optimal rule
using CV-TMLE.</li>
</ol>
<div id="why-cv-tmle" class="section level4">
<h4><span class="header-section-number">4.5.0.1</span> Why CV-TMLE?</h4>
<ul>
<li><p>CV-TMLE is necessary as the non-cross-validated TMLE is biased upward for the
mean outcome under the rule, and therefore overly optimistic.</p></li>
<li><p>More generally however, using CV-TMLE allows us more freedom in estimation and
therefore greater data adaptivity, without sacrificing inference!</p></li>
</ul>
<p>To start, let us load the packages we will use and set a seed for simulation:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(here)
<span class="kw">library</span>(data.table)
<span class="kw">library</span>(sl3)
<span class="kw">library</span>(tmle3)
<span class="kw">library</span>(tmle3mopttx)
<span class="kw">library</span>(devtools)
<span class="kw">set.seed</span>(<span class="dv">111</span>)</code></pre>
</div>
<div id="simulate-data" class="section level4">
<h4><span class="header-section-number">4.5.0.2</span> Simulate Data</h4>
<p>Our data generating distribution is of the following form:</p>

<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;data_bin&quot;</span>)</code></pre>
<ul>
<li><p>The above composes our observed data structure <span class="math inline">\(O = (W, A, Y)\)</span>.</p></li>
<li><p>Note that the mean under the true optimal rule is <span class="math inline">\(\psi=0.578\)</span> for this data
generating distribution.</p></li>
<li><p>Next, we specify the role that each variable in the data set plays as the
nodes in a DAG.</p></li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># organize data and nodes for tmle3</span>
data &lt;-<span class="st"> </span>data_bin
node_list &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">W =</span> <span class="kw">c</span>(<span class="st">&quot;W1&quot;</span>, <span class="st">&quot;W2&quot;</span>, <span class="st">&quot;W3&quot;</span>),
  <span class="dt">A =</span> <span class="st">&quot;A&quot;</span>,
  <span class="dt">Y =</span> <span class="st">&quot;Y&quot;</span>
)</code></pre>
</div>
<div id="constructing-optimal-stacked-regressions-with-sl3" class="section level4">
<h4><span class="header-section-number">4.5.0.3</span> Constructing Optimal Stacked Regressions with <code>sl3</code></h4>
<ul>
<li>We generate three different ensemble learners that must be fit, corresponding
to the learners for the outcome regression, propensity score, and the blip
function.</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Define sl3 library and metalearners:</span>
xgboost_<span class="dv">50</span> &lt;-<span class="st"> </span>Lrnr_xgboost<span class="op">$</span><span class="kw">new</span>(<span class="dt">nrounds =</span> <span class="dv">50</span>)
xgboost_<span class="dv">100</span> &lt;-<span class="st"> </span>Lrnr_xgboost<span class="op">$</span><span class="kw">new</span>(<span class="dt">nrounds =</span> <span class="dv">100</span>)
xgboost_<span class="dv">500</span> &lt;-<span class="st"> </span>Lrnr_xgboost<span class="op">$</span><span class="kw">new</span>(<span class="dt">nrounds =</span> <span class="dv">500</span>)
lrn1 &lt;-<span class="st"> </span>Lrnr_mean<span class="op">$</span><span class="kw">new</span>()
lrn2 &lt;-<span class="st"> </span>Lrnr_glm_fast<span class="op">$</span><span class="kw">new</span>()
lrn3 &lt;-<span class="st"> </span>Lrnr_hal9001<span class="op">$</span><span class="kw">new</span>()

Q_learner &lt;-<span class="st"> </span>Lrnr_sl<span class="op">$</span><span class="kw">new</span>(
  <span class="dt">learners =</span> <span class="kw">list</span>(xgboost_<span class="dv">50</span>, xgboost_<span class="dv">100</span>, xgboost_<span class="dv">500</span>, lrn1, lrn2),
  <span class="dt">metalearner =</span> Lrnr_nnls<span class="op">$</span><span class="kw">new</span>()
)

g_learner &lt;-<span class="st"> </span>Lrnr_sl<span class="op">$</span><span class="kw">new</span>(
  <span class="dt">learners =</span> <span class="kw">list</span>(xgboost_<span class="dv">100</span>, lrn2),
  <span class="dt">metalearner =</span> Lrnr_nnls<span class="op">$</span><span class="kw">new</span>()
)

b_learner &lt;-<span class="st"> </span>Lrnr_sl<span class="op">$</span><span class="kw">new</span>(
  <span class="dt">learners =</span> <span class="kw">list</span>(xgboost_<span class="dv">50</span>, xgboost_<span class="dv">100</span>, xgboost_<span class="dv">500</span>, lrn1, lrn2),
  <span class="dt">metalearner =</span> Lrnr_nnls<span class="op">$</span><span class="kw">new</span>()
)</code></pre>
<ul>
<li>We make the above explicit with respect to standard notation by bundling the
ensemble learners into a list object below:</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># specify outcome and treatment regressions and create learner list</span>
learner_list &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">Y =</span> Q_learner, <span class="dt">A =</span> g_learner, <span class="dt">B =</span> b_learner)</code></pre>
</div>
<div id="targeted-estimation-of-the-mean-under-the-optimal-individualized-interventions-effects" class="section level4">
<h4><span class="header-section-number">4.5.0.4</span> Targeted Estimation of the Mean under the Optimal Individualized Interventions Effects</h4>
<ul>
<li><p>To start, we will initialize a specification for the TMLE of our parameter of
interest simply by calling <code>tmle3_mopttx_blip_revere</code>.</p></li>
<li><p>We specify the argument <code>V = c(&quot;W1&quot;, &quot;W2&quot;, &quot;W3&quot;)</code> when initializing the
<code>tmle3_Spec</code> object in order to communicate that we’re interested in learning
a rule dependent on <code>V</code> covariates.</p></li>
<li><p>We also need to specify the type of blip we will use in this estimation
problem, and the list of learners used to estimate the blip function.</p></li>
<li><p>In addition, we need to specify whether we want to maximize the mean outcome
under the rule (<code>maximize=TRUE</code>).</p></li>
<li><p>If <code>complex=FALSE</code>, <code>tmle3mopttx</code> will consider all the possible rules under a
smaller set of covariates including the static rules, and optimize the mean
outcome over all the suboptimal rules dependent on <span class="math inline">\(V\)</span>.</p></li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># initialize a tmle specification</span>
tmle_spec &lt;-<span class="st"> </span><span class="kw">tmle3_mopttx_blip_revere</span>(
  <span class="dt">V =</span> <span class="kw">c</span>(<span class="st">&quot;W1&quot;</span>, <span class="st">&quot;W2&quot;</span>, <span class="st">&quot;W3&quot;</span>), <span class="dt">type =</span> <span class="st">&quot;blip1&quot;</span>,
  <span class="dt">b_learner =</span> learner_list<span class="op">$</span>B,
  <span class="dt">maximize =</span> <span class="ot">TRUE</span>, <span class="dt">complex =</span> <span class="ot">TRUE</span>
)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># fit the TML estimator</span>
fit &lt;-<span class="st"> </span><span class="kw">tmle3</span>(tmle_spec, data, node_list, learner_list)
fit</code></pre>
<pre><code>A tmle3_Fit that took 1 step(s)
   type         param  init_est  tmle_est         se     lower     upper
1:  TSM E[Y_{A=NULL}] 0.4289592 0.5701264 0.02749039 0.5162462 0.6240065
   psi_transformed lower_transformed upper_transformed
1:       0.5701264         0.5162462         0.6240065</code></pre>
<p>We can see that the estimate of <span class="math inline">\(psi_0\)</span> is <span class="math inline">\(0.56\)</span>, and that the confidence
interval covers our true mean under the true optimal individualized treatment.</p>
</div>
</div>
<div id="extensions-to-causal-effect-of-an-optimal-individualized-intervention" class="section level2">
<h2><span class="header-section-number">4.6</span> Extensions to Causal Effect of an Optimal Individualized Intervention</h2>
<ul>
<li><p>We consider two extensions to the procedure described for estimating the value
of the ITR.</p></li>
<li><p>The first one considers a setting where the user might be interested in a grid
of possible suboptimal rules, corresponding to potentially limited knowledge
of potential effect modifiers (<em>Simpler Rules</em>).</p></li>
<li><p>The second extension concerns implementation of realistic optimal individual
interventions where certain regimes might be preferred, but due to practical
or global positivity restraints are not realistic to implement (<em>Realistic
Interventions</em>).</p></li>
</ul>
<div id="simpler-rules" class="section level3">
<h3><span class="header-section-number">4.6.1</span> Simpler Rules</h3>
<ul>
<li><p>In order to not only consider the most ambitious fully <span class="math inline">\(V\)</span>-optimal rule, we
define <span class="math inline">\(S\)</span>-optimal rules as the optimal rule that considers all possible
subsets of <span class="math inline">\(V\)</span> covariates, with card(<span class="math inline">\(S\)</span>) <span class="math inline">\(\leq\)</span> card(<span class="math inline">\(V\)</span>) and <span class="math inline">\(\emptyset \in S\)</span>.</p></li>
<li><p>This allows us to consider sub-optimal rules that are easier to estimate and
potentially provide more realistic rules- as such, we allow for statistical
inference for the counterfactual mean outcome under the sub-optimal rule.</p></li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># initialize a tmle specification</span>
tmle_spec &lt;-<span class="st"> </span><span class="kw">tmle3_mopttx_blip_revere</span>(
  <span class="dt">V =</span> <span class="kw">c</span>(<span class="st">&quot;W1&quot;</span>, <span class="st">&quot;W2&quot;</span>, <span class="st">&quot;W3&quot;</span>), <span class="dt">type =</span> <span class="st">&quot;blip1&quot;</span>,
  <span class="dt">b_learner =</span> learner_list<span class="op">$</span>B,
  <span class="dt">maximize =</span> <span class="ot">TRUE</span>, <span class="dt">complex =</span> <span class="ot">FALSE</span>
)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># fit the TML estimator</span>
fit &lt;-<span class="st"> </span><span class="kw">tmle3</span>(tmle_spec, data, node_list, learner_list)
fit</code></pre>
<pre><code>A tmle3_Fit that took 1 step(s)
   type       param  init_est  tmle_est         se     lower     upper
1:  TSM E[Y_{A=W3}] 0.4262649 0.5638564 0.02695726 0.5110212 0.6166917
   psi_transformed lower_transformed upper_transformed
1:       0.5638564         0.5110212         0.6166917</code></pre>
<ul>
<li>Even though the user specified all baseline covariates as the basis
for rule estimation, a simpler rule based on only <span class="math inline">\(W_3\)</span> is sufficient to
maximize the mean under the optimal individualized treatment!</li>
</ul>
</div>
<div id="realistic-optimal-individual-regimes" class="section level3">
<h3><span class="header-section-number">4.6.2</span> Realistic Optimal Individual Regimes</h3>
<p>TO DO</p>
</div>
<div id="variable-importance-analysis" class="section level3">
<h3><span class="header-section-number">4.6.3</span> Variable Importance Analysis</h3>
<ul>
<li><p>In the previous sections we have seen how to obtain a contrast between the
mean under the optimal individualized rule and the mean under the observed
outcome for a single covariate. We are now ready to run the variable
importance analysis for all of our observed covariates.</p></li>
<li><p>We will initialize a specification for the TMLE of our parameter of interest
(called a <code>tmle3_Spec</code> in the <code>tlverse</code> nomenclature) simply by calling
<code>tmle3_mopttx_vim</code>.</p></li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># initialize a tmle specification</span>
tmle_spec &lt;-<span class="st"> </span><span class="kw">tmle3_mopttx_vim</span>(
  <span class="dt">V =</span> <span class="kw">c</span>(<span class="st">&quot;W1&quot;</span>, <span class="st">&quot;W2&quot;</span>, <span class="st">&quot;W3&quot;</span>),
  <span class="dt">type =</span> <span class="st">&quot;blip1&quot;</span>,
  <span class="dt">b_learner =</span> learner_list<span class="op">$</span>B,
  <span class="dt">contrast =</span> <span class="st">&quot;multiplicative&quot;</span>,
  <span class="dt">maximize =</span> <span class="ot">FALSE</span>,
  <span class="dt">method =</span> <span class="st">&quot;SL&quot;</span>
)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># fit the TML estimator</span>
vim_results &lt;-<span class="st"> </span><span class="kw">tmle3_vim</span>(tmle_spec, data, node_list, learner_list,
  <span class="dt">adjust_for_other_A =</span> <span class="ot">FALSE</span>
)
vim_results</code></pre>
<p>Comment…</p>
</div>
</div>
<div id="categorical-treatment" class="section level2">
<h2><span class="header-section-number">4.7</span> Categorical treatment</h2>
<ul>
<li><p>What if the treatment is categorical? Can we still use the blip function?</p></li>
<li><p>We define <em>pseudo-blips</em> as vector valued entities where the output for a
given <span class="math inline">\(V\)</span> is a vector of length equal to the number of treatment categories,
<span class="math inline">\(n_A\)</span>. As such, we define it as:
<span class="math display">\[\bar{Q}_0^{pblip}(V) = \{\bar{Q}_{0,a}^{pblip}(V): a \in \mathcal{A} \}\]</span></p></li>
<li><p>We implement three different pseudo-blips in <code>tmle3mopttx</code>.</p></li>
</ul>
<ol style="list-style-type: decimal">
<li><em>Blip1</em> corresponds to choosing a reference category of treatment, and
defining the blip for all other categories relative to the specified
reference: <span class="math display">\[\bar{Q}_{0,a}^{pblip-ref}(V) \equiv E_0(Y_a-Y_0|V)\]</span></li>
<li><em>Blip2</em> approach corresponds to defining the blip relative to the average of
all categories:
<span class="math display">\[\bar{Q}_{0,a}^{pblip-avg}(V) \equiv E_0(Y_a- \frac{1}{n_A} \sum_{a \in
\mathcal{A}} Y_a|V)\]</span></li>
<li><em>Blip3</em> reflects an extension of Blip2, where the average is now a weighted
average:
<span class="math display">\[\bar{Q}_{0,a}^{pblip-wavg}(V) \equiv E_0(Y_a- \frac{1}{n_A} \sum_{a \in
\mathcal{A}} Y_{a} P(A=a \mid V) \mid V)\]</span></li>
</ol>
</div>
<div id="exercise-optimal-individualized-intervention-with-categorical-treatment" class="section level2">
<h2><span class="header-section-number">4.8</span> Exercise: Optimal Individualized Intervention with Categorical Treatment</h2>
<p>Our data generating distribution is of the following form:</p>

<p>We can just load the data available as part of the package as follows:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;data_cat&quot;</span>)</code></pre>
<p>The mean under the true optimal rule is <span class="math inline">\(\psi=0.625\)</span>, which is the quantity we
aim to estimate.</p>
<div id="specify-the-npsem" class="section level4">
<h4><span class="header-section-number">4.8.0.1</span> Specify the NPSEM</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># organize data and nodes for tmle3</span>
data &lt;-<span class="st"> </span>data_cat
node_list &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">W =</span> <span class="kw">c</span>(<span class="st">&quot;W1&quot;</span>, <span class="st">&quot;W2&quot;</span>, <span class="st">&quot;W3&quot;</span>, <span class="st">&quot;W4&quot;</span>),
  <span class="dt">A =</span> <span class="st">&quot;A&quot;</span>,
  <span class="dt">Y =</span> <span class="st">&quot;Y&quot;</span>
)</code></pre>
</div>
<div id="create-the-super-learner-library" class="section level4">
<h4><span class="header-section-number">4.8.0.2</span> Create the Super Learner library</h4>
<ol style="list-style-type: decimal">
<li>Note that we need to estimate <span class="math inline">\(g_0(A|W)\)</span> for a categorical <span class="math inline">\(A\)</span>- therefore we
will need to use the multinomial Super Learner option available within the
<code>sl3</code> package with learners that can address multi-class classification
problems. In order to see which learners can be used to estimate
<span class="math inline">\(g_0(A \mid W)\)</span> in <code>sl3</code>, we run the following:</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># See which learners support multi-class classification:</span>
<span class="kw">sl3_list_learners</span>(<span class="kw">c</span>(<span class="st">&quot;categorical&quot;</span>))</code></pre>
<pre><code> [1] &quot;Lrnr_bartMachine&quot;          &quot;Lrnr_dbarts&quot;              
 [3] &quot;Lrnr_glmnet&quot;               &quot;Lrnr_grf&quot;                 
 [5] &quot;Lrnr_h2o_glm&quot;              &quot;Lrnr_h2o_grid&quot;            
 [7] &quot;Lrnr_independent_binomial&quot; &quot;Lrnr_mean&quot;                
 [9] &quot;Lrnr_multivariate&quot;         &quot;Lrnr_optim&quot;               
[11] &quot;Lrnr_randomForest&quot;         &quot;Lrnr_ranger&quot;              
[13] &quot;Lrnr_rpart&quot;                &quot;Lrnr_solnp&quot;               
[15] &quot;Lrnr_svm&quot;                  &quot;Lrnr_xgboost&quot;             </code></pre>
<ol start="2" style="list-style-type: decimal">
<li>In addition, since the corresponding blip will be vector valued, we will have
a column for each additional level of treatment. As such, we need to create
multivariate learners with the helper function <code>create_mv_learners</code> that
takes a list of initialized learners as input.</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Initialize some of the learners.</span>
<span class="co"># Here we use xgboost with various parameters, glm, HAL and the mean.</span>
xgboost_<span class="dv">50</span> &lt;-<span class="st"> </span>Lrnr_xgboost<span class="op">$</span><span class="kw">new</span>(<span class="dt">nrounds =</span> <span class="dv">50</span>)
xgboost_<span class="dv">100</span> &lt;-<span class="st"> </span>Lrnr_xgboost<span class="op">$</span><span class="kw">new</span>(<span class="dt">nrounds =</span> <span class="dv">100</span>)
xgboost_<span class="dv">500</span> &lt;-<span class="st"> </span>Lrnr_xgboost<span class="op">$</span><span class="kw">new</span>(<span class="dt">nrounds =</span> <span class="dv">500</span>)
lrn1 &lt;-<span class="st"> </span>Lrnr_mean<span class="op">$</span><span class="kw">new</span>()
lrn2 &lt;-<span class="st"> </span>Lrnr_glm_fast<span class="op">$</span><span class="kw">new</span>()
lrn3 &lt;-<span class="st"> </span>Lrnr_hal9001<span class="op">$</span><span class="kw">new</span>()

<span class="co"># Define the Q learner, which is just a regular learner:</span>
Q_learner &lt;-<span class="st"> </span>Lrnr_sl<span class="op">$</span><span class="kw">new</span>(
  <span class="dt">learners =</span> <span class="kw">list</span>(xgboost_<span class="dv">50</span>, xgboost_<span class="dv">100</span>, xgboost_<span class="dv">500</span>, lrn1, lrn2),
  <span class="dt">metalearner =</span> Lrnr_nnls<span class="op">$</span><span class="kw">new</span>()
)

<span class="co"># Define the g learner, which is a multinomial learner:</span>
glib &lt;-<span class="st"> </span><span class="kw">list</span>(
  rf &lt;-<span class="st"> </span><span class="kw">make_learner</span>(Lrnr_randomForest),
  xgb &lt;-<span class="st"> </span><span class="kw">make_learner</span>(Lrnr_xgboost),
  glmnet &lt;-<span class="st"> </span><span class="kw">make_learner</span>(Lrnr_glmnet),
  multinom_gf &lt;-<span class="st"> </span><span class="kw">make_learner</span>(Lrnr_independent_binomial, <span class="kw">make_learner</span>(Lrnr_glm_fast)),
  mean &lt;-<span class="st"> </span><span class="kw">make_learner</span>(Lrnr_mean)
)

<span class="co"># Specify the appropriate loss of the multinomial learner:</span>
mn_metalearner &lt;-<span class="st"> </span><span class="kw">make_learner</span>(Lrnr_solnp,
  <span class="dt">loss_function =</span> loss_loglik_multinomial,
  <span class="dt">learner_function =</span> metalearner_linear_multinomial
)
g_learner &lt;-<span class="st"> </span><span class="kw">make_learner</span>(Lrnr_sl, glib, mn_metalearner)

<span class="co"># Define the Blip learner, which is a multivariate learner:</span>
learners &lt;-<span class="st"> </span><span class="kw">list</span>(xgboost_<span class="dv">50</span>, xgboost_<span class="dv">100</span>, xgboost_<span class="dv">500</span>, lrn1, lrn2)
b_learner &lt;-<span class="st"> </span><span class="kw">create_mv_learners</span>(<span class="dt">learners =</span> learners)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># specify outcome and treatment regressions and create learner list</span>
learner_list &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">Y =</span> Q_learner, <span class="dt">A =</span> g_learner, <span class="dt">B =</span> b_learner)</code></pre>
</div>
<div id="targeted-estimation-of-the-mean-under-the-optimal-individualized-interventions-effects-1" class="section level4">
<h4><span class="header-section-number">4.8.0.3</span> Targeted Estimation of the Mean under the Optimal Individualized Interventions Effects</h4>
<ol style="list-style-type: decimal">
<li>Does it matter which blip type we use?</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># initialize a tmle specification</span>
tmle_spec &lt;-<span class="st"> </span><span class="kw">tmle3_mopttx_blip_revere</span>(
  <span class="dt">V =</span> <span class="kw">c</span>(<span class="st">&quot;W1&quot;</span>, <span class="st">&quot;W2&quot;</span>, <span class="st">&quot;W3&quot;</span>, <span class="st">&quot;W4&quot;</span>), <span class="dt">type =</span> <span class="st">&quot;blip2&quot;</span>,
  <span class="dt">b_learner =</span> learner_list<span class="op">$</span>B, <span class="dt">maximize =</span> <span class="ot">TRUE</span>, <span class="dt">complex =</span> <span class="ot">TRUE</span>
)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># fit the TML estimator</span>
fit &lt;-<span class="st"> </span><span class="kw">tmle3</span>(tmle_spec, data, node_list, learner_list)
fit</code></pre>
<pre><code>A tmle3_Fit that took 1 step(s)
   type         param  init_est  tmle_est         se     lower     upper
1:  TSM E[Y_{A=NULL}] 0.4838061 0.5773642 0.02537573 0.5276287 0.6270997
   psi_transformed lower_transformed upper_transformed
1:       0.5773642         0.5276287         0.6270997</code></pre>
<p>We can see that the estimate of <span class="math inline">\(psi_0\)</span> is <span class="math inline">\(0.58\)</span>, and that the confidence
interval covers our true mean under the true optimal individualized treatment.</p>
</div>
</div>
<div id="exercise-wash-benefits-data" class="section level2">
<h2><span class="header-section-number">4.9</span> Exercise: WASH Benefits Data</h2>
<ul>
<li><p>We cement everything we learned so far with a real data application!</p></li>
<li><p>We will be using the WASH Benefits data, corresponding to the Effect of water
quality, sanitation, hand washing, and nutritional interventions on child
development in rural Bangladesh trial.</p></li>
<li><p>The main aim of the cluster-randomised controlled trial was to assess the
impact of six intervention groups, including:</p></li>
</ul>
<ol style="list-style-type: decimal">
<li><p>chlorinated drinking water</p></li>
<li><p>improved sanitation</p></li>
<li><p>handwashing with soap</p></li>
<li><p>combined water, sanitation, and handwashing</p></li>
<li><p>improved nutrition through counselling and provision of lipid-based nutrient
supplements</p></li>
<li><p>combined water, sanitation, handwashing, and nutrition.</p></li>
</ol>
<ul>
<li>We aim to estimate the optimal ITR and the corresponding value under the
optimal ITR for the main intervention in WASH Benefits data.</li>
</ul>
<p>To start, let’s load the data, convert all columns to be of class <code>numeric</code>,
and take a quick look at it:</p>
<pre class="sourceCode r"><code class="sourceCode r">washb_data &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="kw">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;washb_data.csv&quot;</span>), <span class="dt">stringsAsFactors =</span> <span class="ot">TRUE</span>)
washb_data &lt;-<span class="st"> </span>washb_data[<span class="op">!</span><span class="kw">is.na</span>(momage), <span class="kw">lapply</span>(.SD, as.numeric)]
<span class="kw">head</span>(washb_data, <span class="dv">3</span>)</code></pre>
<pre><code>     whz tr fracode month aged sex momage momedu momheight hfiacat Nlt18 Ncomp
1:  0.00  1       4     9  268   2     30      2    146.40       1     3    11
2: -1.16  1       4     9  286   2     25      2    148.75       3     2     4
3: -1.05  1      20     9  264   2     25      2    152.15       1     1    10
   watmin elec floor walls roof asset_wardrobe asset_table asset_chair
1:      0    1     0     1    1              0           1           1
2:      0    1     0     1    1              0           1           0
3:      0    0     0     1    1              0           0           1
   asset_khat asset_chouki asset_tv asset_refrig asset_bike asset_moto
1:          1            0        1            0          0          0
2:          1            1        0            0          0          0
3:          0            1        0            0          0          0
   asset_sewmach asset_mobile
1:             0            1
2:             0            1
3:             0            1</code></pre>
<ul>
<li><p>Our outcome of interest is the weight-for-height Z-score which we seek to
maximize, whereas our treatment is the six intervention groups aimed at
improving living conditions.</p></li>
<li><p>All the other collected baseline covariates correspond to <span class="math inline">\(W\)</span>.</p></li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r">node_list &lt;-<span class="st"> </span><span class="kw">list</span>(
  <span class="dt">W =</span> <span class="kw">names</span>(washb_data)[<span class="op">!</span>(<span class="kw">names</span>(washb_data) <span class="op">%in%</span>
<span class="st">    </span><span class="kw">c</span>(<span class="st">&quot;whz&quot;</span>, <span class="st">&quot;tr&quot;</span>))],
  <span class="dt">A =</span> <span class="st">&quot;tr&quot;</span>,
  <span class="dt">Y =</span> <span class="st">&quot;whz&quot;</span>
)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">xgboost_<span class="dv">100</span> &lt;-<span class="st"> </span>Lrnr_xgboost<span class="op">$</span><span class="kw">new</span>(<span class="dt">nrounds =</span> <span class="dv">100</span>)
xgboost_<span class="dv">500</span> &lt;-<span class="st"> </span>Lrnr_xgboost<span class="op">$</span><span class="kw">new</span>(<span class="dt">nrounds =</span> <span class="dv">500</span>)
glm_fast &lt;-<span class="st"> </span>Lrnr_glm_fast<span class="op">$</span><span class="kw">new</span>()
lrn_mean &lt;-<span class="st"> </span>Lrnr_mean<span class="op">$</span><span class="kw">new</span>()

<span class="co"># Define the Q learner, which is just a regular learner:</span>
Q_learner &lt;-<span class="st"> </span>Lrnr_sl<span class="op">$</span><span class="kw">new</span>(
  <span class="dt">learners =</span> <span class="kw">list</span>(xgboost_<span class="dv">100</span>, xgboost_<span class="dv">500</span>, lrn_mean),
  <span class="dt">metalearner =</span> Lrnr_nnls<span class="op">$</span><span class="kw">new</span>()
)

<span class="co"># Define the g learner, which is a multinomial learner:</span>
glib &lt;-<span class="st"> </span><span class="kw">list</span>(
  xgb &lt;-<span class="st"> </span><span class="kw">make_learner</span>(Lrnr_xgboost),
  mean &lt;-<span class="st"> </span><span class="kw">make_learner</span>(Lrnr_mean)
)

<span class="co"># Specify the appropriate loss of the multinomial learner:</span>
mn_metalearner &lt;-<span class="st"> </span><span class="kw">make_learner</span>(Lrnr_solnp,
  <span class="dt">loss_function =</span> loss_loglik_multinomial,
  <span class="dt">learner_function =</span> metalearner_linear_multinomial
)
g_learner &lt;-<span class="st"> </span><span class="kw">make_learner</span>(Lrnr_sl, glib, mn_metalearner)

<span class="co"># Define the Blip learner, which is a multivariate learner:</span>
learners &lt;-<span class="st"> </span><span class="kw">list</span>(xgboost_<span class="dv">100</span>, xgboost_<span class="dv">500</span>, lrn_mean)
b_learner &lt;-<span class="st"> </span><span class="kw">create_mv_learners</span>(<span class="dt">learners =</span> learners)

<span class="co"># specify outcome and treatment regressions and create learner list</span>
learner_list &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">Y =</span> Q_learner, <span class="dt">A =</span> g_learner, <span class="dt">B =</span> b_learner)</code></pre>
<ul>
<li>We pick a few potential effect modifiers, including mother’s education,
current living conditions (floor), and possession of material items including
the refrigerator. concentrate of these covariates as they might be indicative
of the socio-economic status of individuals involved in the trial.</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(washb_data<span class="op">$</span>momedu)</code></pre>
<pre><code>
   1    2    3 
 733 1441 2503 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(washb_data<span class="op">$</span>floor)</code></pre>
<pre><code>
   0    1 
4177  500 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(washb_data<span class="op">$</span>asset_refrig)</code></pre>
<pre><code>
   0    1 
4305  372 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># initialize a tmle specification</span>
tmle_spec &lt;-<span class="st"> </span><span class="kw">tmle3_mopttx_blip_revere</span>(
  <span class="dt">V =</span> <span class="kw">c</span>(<span class="st">&quot;momedu&quot;</span>, <span class="st">&quot;floor&quot;</span>, <span class="st">&quot;asset_refrig&quot;</span>), <span class="dt">type =</span> <span class="st">&quot;blip2&quot;</span>,
  <span class="dt">b_learner =</span> learner_list<span class="op">$</span>B, <span class="dt">maximize =</span> <span class="ot">TRUE</span>, <span class="dt">complex =</span> <span class="ot">TRUE</span>
)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># fit the TML estimator</span>
fit &lt;-<span class="st"> </span><span class="kw">tmle3</span>(tmle_spec, <span class="dt">data =</span> washb_data, node_list, learner_list)
fit</code></pre>
<pre><code>A tmle3_Fit that took 1 step(s)
   type         param   init_est   tmle_est         se      lower      upper
1:  TSM E[Y_{A=NULL}] -0.5589163 -0.4657452 0.04317455 -0.5503658 -0.3811246
   psi_transformed lower_transformed upper_transformed
1:      -0.4657452        -0.5503658        -0.3811246</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="tmle3-the-targeted-learning-framework.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="stochastic-treatment-regimes.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/tlverse/acic2019-workshop/edit/master/05-tmle3mopttx.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["acic2019_workshop.pdf", "acic2019_workshop.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
