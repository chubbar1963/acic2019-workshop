---
title: "Statistical Roadmap and Data Intro"
author: "Alan Hubbard"
date: "`r Sys.Date()`"
output: pdf_document
bibliography: refs.bib
editor_options: 
  chunk_output_type: console
---

## Learning Objectives
1. Introduce the data being used in workshp
2. Introduce the statistical roadmap on which the methods are based.

## The Data
The data come from the Effect of water quality, sanitation, hand washing, and
nutritional interventions on child development in rural
Bangladesh (WASH Benefits Bangladesh):
a cluster-randomised controlled trial (@luby2018effects). The study enrolled enrolled pregnant women in their first or second trimester
from rural villages of Gazipur, Kishoreganj, Mymensingh, and Tangail districts of central Bangladesh, with an average
of eight women per cluster. Groups of eight geographically adjacent clusters were block-randomised, using a random
number generator, into six intervention groups (all of which received weekly visits from a community health promoter
for the first 6 months and every 2 weeks for the next 18 months) and a double-sized control group (no intervention or
health promoter visit). The six intervention groups were: chlorinated drinking water; improved sanitation;
handwashing with soap; combined water, sanitation, and handwashing; improved nutrition through counselling and
provision of lipid-based nutrient supplements; and combined water, sanitation, handwashing, and nutrition. In the workshop, we concentrate child-growth (size for age) as the outcome.  This trial was registered with ClinicalTrials.gov, number NCT01590095.

```{r}
library(tidyverse)
library(tlverse)
library(xtable)

## Read in data
dat <- read_csv("../washb_data/washb_data.csv") 
tibble(dat)
```

For the purposes of this workshop, we we start by treating the data as independent and identically distributed (i.i.d.) random draws from a very large target population.  We could, with available options,  account for the clustering of the data (within sampled geographic units), but avoiding these details for this workshop.

We have 2 variables and 1 variable set of interest.  Our outcome, $Y$, is *whz* -- weight For height Z-score, the treatment of interest, $A$, is *tr* -- randomized treatment group, and 
our adjustment variables, $W$, are *everything else*.  This results in our observed data structure as $i=1,...,n$ i.i.d. copies of $O_i = (W_i,A_i,Y_i)$. 

Modifications of our methods for biased samples, repeated measures, etc. are available. 

### The variables
```{r, echo=FALSE, include=F}
categ <- dat[,c(2,6,8,10,14:28)]
ncat <- dim(categ)[2]
vars.cat <- names(categ)
cont <- dat[,-c(2,3,6,8,10,14:28)]
ncont <- dim(cont)[2]
vars.cont <- names(cont)

# First do "continuous"" variables
var.out <- NULL
tab1.out <- NULL
hline <- c(-1,0)
for(i in 1:ncont) {
var.out <- c(var.out,vars.cont[i])
  x = as.numeric(unlist(cont[,i]))
  tab1.out <- rbind(tab1.out,c(mean(x,na.rm=T),sd(x,na.rm=T),NA,NA))
  hline=c(hline,i)
}

tab1.out <- data.frame(levels="",tab1.out)
names(tab1.out)<- c("levels","Mean","SD","Count","Row.Prop")
# Do categorical variables
cnter <- ncont
for(i in 1:ncat) {
  hline <- c(hline,cnter)
  x = unlist(categ[,i])
  tt <- table(x)
  levels <- names(tt)
  nt <- length(tt)
  tt <- as.vector(tt)
  out <- data.frame(levels=levels,Mean=rep(NA,nt),SD=rep(NA,nt),Count=tt,Row.Perc=tt/sum(tt))
names(out)<- c("levels","Mean","SD","Count","Row.Prop")
  var.out <- c(var.out,c(vars.cat[i],rep("",nrow(out)-1)))
  cnter <- cnter+nrow(out)
  tab1.out <- rbind(tab1.out,out)
}

times <- rep("base",nrow(tab1.out))

tab1.out <- data.frame(Variable=var.out,tab1.out)
```

## The model


```{r, echo=F, include=F}
# Change label from tabl
tab1=xtable::xtable(tab1.out, 
  caption = "Distribution of variables used in WASH-Benefits Study", label = "table_1", digits = 4,rownames=F,display=c("s","s","s","f","f","d","f"),align = "l|l|r|c|c||c|c|")
print(tab1,type="latex",file="../vignettes/table1.tex",caption.placement="top",include.rownames=F,hline.after=hline)

```
\include{table1}

The distribution of relevant variables is shown in Table \ref{table_1}.  

## References

